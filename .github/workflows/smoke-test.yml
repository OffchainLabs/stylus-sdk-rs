name: Smoke Test
on:
  pull_request:
  workflow_dispatch:
  push:
    branches:
      - main
      - ci-testing
jobs:
  smoke-test:
    runs-on: ubuntu-latest
    name: smoke-test ${{ matrix.toolchain }}
    env:
      CFG_RELEASE_CHANNEL: ${{ matrix.toolchain }}
    strategy:
      matrix:
        toolchain: [1.87.0, nightly-2025-06-26]
    steps:
      - name: checkout
        uses: actions/checkout@v3
      - name: Install ${{ matrix.toolchain }}
        uses: dtolnay/rust-toolchain@stable
        with:
          toolchain: ${{ matrix.toolchain }}
          targets: wasm32-unknown-unknown
      - name: Cargo stylus
        run: |
          RUSTFLAGS="-C link-args=-rdynamic" cargo install --force cargo-stylus
      - uses: OffchainLabs/actions/run-nitro-test-node@main
        with:
          nitro-testnode-ref: release
          no-token-bridge: true
          # no-simple must be false for now as our nitro testnode branch doesn't have that option
          no-simple: false
      - name: Smoke Test Deployment
        run: ./ci/smoke_test.sh
